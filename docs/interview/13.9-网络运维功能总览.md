# 网络运维功能总览

## 1. 功能概述

网络运维功能提供 VM 网络的高级管理和控制能力，包括多网卡配置、IP 管理、服务暴露、网络策略等。

## 2. 功能列表

| 功能 | 优先级 | 复杂度 | 业务价值 | 当前状态 |
|------|--------|--------|----------|----------|
| **多网卡配置** | 高 | 中 | 高 | 部分实现 |
| **静态IP绑定** | 高 | 中 | 高 | 部分实现 |
| **端口映射/Service暴露** | 高 | 中 | 高 | 待实现 |
| **网络策略管控** | 中 | 高 | 中 | 待实现 |
| **访问控制** | 中 | 高 | 中 | 待实现 |
| **出入站限流** | 低 | 高 | 低 | 待实现 |

## 3. 当前实现状态

### 3.1 已实现
- ✅ **多网卡支持**: 通过 `Networks` 数组支持多个网络接口
- ✅ **静态IP配置**: 通过 `IPConfig` 支持静态 IP 配置
- ✅ **DHCP支持**: 支持 DHCP 自动获取 IP
- ✅ **Multus集成**: 支持 Multus CNI 多网络
- ✅ **VLAN支持**: 支持 VLAN 配置

### 3.2 待实现
- ❌ **IP绑定验证**: 验证静态 IP 是否可用
- ❌ **端口映射**: 将 VM 端口映射到节点或 Service
- ❌ **Service暴露**: 通过 Kubernetes Service 暴露 VM
- ❌ **网络策略**: 使用 NetworkPolicy 控制流量
- ❌ **访问控制列表**: 细粒度访问控制
- ❌ **流量限流**: 出入站流量限流

## 4. 技术实现方式

### 4.1 多网卡配置
- 通过 `Networks` 数组配置多个网络接口
- 每个接口可以有不同的类型和配置
- 支持 Multus 多网络

### 4.2 静态IP绑定
- 通过 `IPConfig` 配置静态 IP
- 使用 NMState 或 Cloud-Init 配置
- 需要验证 IP 可用性

### 4.3 端口映射/Service暴露
- 使用 Kubernetes Service（NodePort/LoadBalancer）
- 使用 HostPort 直接映射
- 使用 Ingress 暴露服务

### 4.4 网络策略管控
- 使用 Kubernetes NetworkPolicy
- 使用 Cilium NetworkPolicy（如果使用 Cilium）
- 使用自定义网络策略

## 5. 功能分类

### 5.1 网络配置类
- **多网卡配置**: 配置多个网络接口
- **静态IP绑定**: 绑定固定 IP 地址

### 5.2 服务暴露类
- **端口映射**: 映射 VM 端口到节点
- **Service暴露**: 通过 Kubernetes Service 暴露

### 5.3 安全管控类
- **网络策略**: 控制网络流量
- **访问控制**: 细粒度访问控制
- **流量限流**: 出入站流量限流

## 6. 实现优先级

### 第一阶段（核心功能）
1. **多网卡配置完善** - 完善多网卡配置和管理
2. **静态IP绑定完善** - 完善静态 IP 绑定和验证
3. **端口映射** - 实现端口映射功能

### 第二阶段（增强功能）
4. **Service暴露** - 通过 Service 暴露 VM 服务
5. **网络策略** - 实现网络策略管控

### 第三阶段（高级特性）
6. **访问控制列表** - 细粒度访问控制
7. **流量限流** - 出入站流量限流

## 7. 文档结构

- **[13.9.1-多网卡配置.md](./13.9.1-多网卡配置.md)** - 多网卡配置详解
- **[13.9.2-静态IP绑定.md](./13.9.2-静态IP绑定.md)** - 静态 IP 绑定详解
- **[13.9.3-端口映射与Service暴露.md](./13.9.3-端口映射与Service暴露.md)** - 端口映射和 Service 暴露详解
- **[13.9.4-网络策略管控.md](./13.9.4-网络策略管控.md)** - 网络策略、访问控制、流量限流详解

## 8. 使用示例

### 8.1 多网卡配置
```yaml
apiVersion: vm.novasphere.dev/v1alpha1
kind: Wukong
spec:
  networks:
  - name: eth0
    type: bridge
  - name: eth1
    type: macvlan
    vlanId: 100
```

### 8.2 静态IP绑定
```yaml
apiVersion: vm.novasphere.dev/v1alpha1
kind: Wukong
spec:
  networks:
  - name: eth0
    type: bridge
    ipConfig:
      mode: static
      address: "192.168.1.100/24"
      gateway: "192.168.1.1"
```

### 8.3 端口映射
```yaml
apiVersion: vm.novasphere.dev/v1alpha1
kind: Wukong
spec:
  networks:
  - name: eth0
    type: bridge
    portMappings:
    - protocol: TCP
      containerPort: 80
      hostPort: 30080
```

## 9. 注意事项

### 9.1 网络配置
- 多网卡需要正确配置路由
- 静态 IP 需要确保不冲突
- 需要验证网络配置有效性

### 9.2 安全考虑
- 端口映射需要考虑安全风险
- 网络策略需要正确配置
- 访问控制需要定期审查

### 9.3 性能影响
- 多网卡可能影响性能
- 网络策略可能影响性能
- 流量限流需要合理配置

## 10. 面试要点

### 10.1 为什么需要多网卡配置？

**答案**:
- **网络隔离**: 不同业务使用不同网络
- **性能优化**: 分离数据流量和管理流量
- **安全隔离**: 关键业务网络隔离
- **灵活配置**: 根据需求灵活配置网络

### 10.2 静态IP绑定的实现方式？

**答案**:
- 通过 NMState 配置网络接口
- 通过 Cloud-Init 配置网络
- 验证 IP 地址可用性
- 确保 IP 地址不冲突

### 10.3 如何通过 Kubernetes Service 暴露 VM？

**答案**:
- 创建 Service 指向 VM 的 Pod IP
- 使用 NodePort 或 LoadBalancer 类型
- 通过 Endpoints 或 EndpointSlice 管理
- 支持多端口暴露

