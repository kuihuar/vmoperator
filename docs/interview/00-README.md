# VM Operator 架构文档 - 面试准备

本目录包含 VM Operator 项目的详细架构文档，用于面试和技术分享。

## 文档结构

### 基础文档
1. **[01-整体架构概览.md](./01-整体架构概览.md)** - 项目整体架构、技术栈、核心概念
2. **[02-Controller详解.md](./02-Controller详解.md)** - Controller 和 Reconcile 循环详解
3. **[03-CRD基础结构.md](./03-CRD基础结构.md)** - Wukong CRD 基础结构和状态管理
4. **[04-Spec字段详解.md](./04-Spec字段详解.md)** - Spec 字段详细说明和使用示例

### 网络管理
5. **[05-网络管理概述.md](./05-网络管理概述.md)** - 网络管理整体架构和流程
6. **[05.1-Multus集成详解.md](./05.1-Multus集成详解.md)** - Multus CNI 集成实现细节
7. **[05.2-NMState集成详解.md](./05.2-NMState集成详解.md)** - NMState 集成（占位实现）

### 存储管理
8. **[06-存储管理概述.md](./06-存储管理概述.md)** - 存储管理整体架构
9. **[06.1-PVC管理详解.md](./06.1-PVC管理详解.md)** - PVC 创建和管理
10. **[06.2-CDI集成详解.md](./06.2-CDI集成详解.md)** - CDI DataVolume 集成

### KubeVirt 集成
11. **[07-KubeVirt集成概述.md](./07-KubeVirt集成概述.md)** - KubeVirt 集成概述
12. **[07.1-VM构建详解.md](./07.1-VM构建详解.md)** - VM 构建流程详解
13. **[07.2-CloudInit配置详解.md](./07.2-CloudInit配置详解.md)** - Cloud-Init 配置

### 其他
14. **[08-设计模式与最佳实践.md](./08-设计模式与最佳实践.md)** - Operator 设计模式
15. **[09-面试要点总结.md](./09-面试要点总结.md)** - 常见面试问题总结
16. **[10-验证与Webhook详解.md](./10-验证与Webhook详解.md)** - 验证机制和 Webhook 详解
17. **[11-Webhook实现说明.md](./11-Webhook实现说明.md)** - Webhook 实现说明和部署指南
18. **[12-开发环境配置.md](./12-开发环境配置.md)** - 开发环境配置（禁用 Webhook 等）

### VM 高级功能规划
19. **[13-VM功能规划总览.md](./13-VM功能规划总览.md)** - VM 高级功能规划总览和优先级
20. **[13.1-导入导出功能.md](./13.1-导入导出功能.md)** - 导入和导出功能详解
21. **[13.2-克隆功能.md](./13.2-克隆功能.md)** - VM 克隆功能详解
22. **[13.3-快照功能.md](./13.3-快照功能.md)** - 快照管理功能详解
23. **[13.4-空虚拟机与PVC磁盘.md](./13.4-空虚拟机与PVC磁盘.md)** - 空虚拟机和基于 PVC 创建
24. **[13.5-运行态克隆.md](./13.5-运行态克隆.md)** - VMIS 运行态克隆详解
25. **[13.6-批量创建VM.md](./13.6-批量创建VM.md)** - 批量创建和规模化部署

### 基础运维功能
26. **[13.7-基础运维功能总览.md](./13.7-基础运维功能总览.md)** - 基础运维功能总览和优先级
27. **[13.7.1-启动与关机.md](./13.7.1-启动与关机.md)** - 启动和关机功能详解
28. **[13.7.2-重启功能.md](./13.7.2-重启功能.md)** - 重启功能详解
29. **[13.7.3-挂起与恢复.md](./13.7.3-挂起与恢复.md)** - 挂起和恢复功能详解
30. **[13.7.4-删除功能.md](./13.7.4-删除功能.md)** - 删除功能详解

### 资源弹性伸缩
31. **[13.8-资源弹性伸缩总览.md](./13.8-资源弹性伸缩总览.md)** - 资源弹性伸缩功能总览
32. **[13.8.1-CPU内存扩缩容.md](./13.8.1-CPU内存扩缩容.md)** - CPU 和内存扩缩容详解
33. **[13.8.2-磁盘热扩容.md](./13.8.2-磁盘热扩容.md)** - 磁盘热扩容详解
34. **[13.8.3-动态挂载卸载磁盘.md](./13.8.3-动态挂载卸载磁盘.md)** - 动态挂载/卸载磁盘详解
35. **[13.8.4-网络扩缩容.md](./13.8.4-网络扩缩容.md)** - 网络扩缩容详解

### 网络运维功能
36. **[13.9-网络运维功能总览.md](./13.9-网络运维功能总览.md)** - 网络运维功能总览
37. **[13.9.1-多网卡配置.md](./13.9.1-多网卡配置.md)** - 多网卡配置详解
38. **[13.9.2-静态IP绑定.md](./13.9.2-静态IP绑定.md)** - 静态 IP 绑定详解
39. **[13.9.3-端口映射与Service暴露.md](./13.9.3-端口映射与Service暴露.md)** - 端口映射和 Service 暴露详解
40. **[13.9.4-网络策略管控.md](./13.9.4-网络策略管控.md)** - 网络策略、访问控制、流量限流详解

### 调度能力
41. **[13.10-调度能力总览.md](./13.10-调度能力总览.md)** - 调度能力总览
42. **[13.10.1-节点亲和性与反亲和性.md](./13.10.1-节点亲和性与反亲和性.md)** - 节点亲和性和反亲和性详解
43. **[13.10.2-污点与容忍度.md](./13.10.2-污点与容忍度.md)** - 污点和容忍度详解
44. **[13.10.3-Pod亲和性与反亲和性.md](./13.10.3-Pod亲和性与反亲和性.md)** - Pod 亲和性和反亲和性详解
45. **[13.10.4-资源亲和性与调度策略.md](./13.10.4-资源亲和性与调度策略.md)** - 资源亲和性和调度策略详解

### 控制台交互功能
46. **[13.11-控制台交互功能总览.md](./13.11-控制台交互功能总览.md)** - 控制台交互功能总览
47. **[13.11.1-VNC控制台.md](./13.11.1-VNC控制台.md)** - VNC 控制台详解
48. **[13.11.2-SPICE控制台.md](./13.11.2-SPICE控制台.md)** - SPICE 控制台详解
49. **[13.11.3-串行控制台.md](./13.11.3-串行控制台.md)** - 串行控制台详解
50. **[13.11.4-文件传输.md](./13.11.4-文件传输.md)** - 文件传输功能详解

### 高级功能
51. **[13.12-实时迁移功能.md](./13.12-实时迁移功能.md)** - 实时迁移（Live Migration）功能详解

### 部署与运维
52. **[14-Helm打包与部署总览.md](./14-Helm打包与部署总览.md)** - Helm 打包与部署总览
53. **[14.1-当前部署方式详解.md](./14.1-当前部署方式详解.md)** - 当前 Kustomize 部署方式说明
54. **[14.2-Helm Chart 结构设计.md](./14.2-Helm Chart 结构设计.md)** - Helm Chart 目录结构和模板设计
55. **[14.3-Values 配置说明.md](./14.3-Values 配置说明.md)** - Helm Values 参数详解
56. **[14.4-多环境部署策略.md](./14.4-多环境部署策略.md)** - 开发、测试、生产环境配置
57. **[14.5-构建与发布流程.md](./14.5-构建与发布流程.md)** - Helm Chart 构建和发布流程

### 技术栈 Helm 管理
58. **[15-技术栈Helm包管理总览.md](./15-技术栈Helm包管理总览.md)** - 技术栈 Helm 包管理总览
59. **[15.1-k3s Helm管理规划.md](./15.1-k3s Helm管理规划.md)** - k3s 安装和配置管理
60. **[15.2-KubeVirt Helm管理规划.md](./15.2-KubeVirt Helm管理规划.md)** - KubeVirt 部署和配置
61. **[15.3-CDI Helm管理规划.md](./15.3-CDI Helm管理规划.md)** - CDI 部署和配置
62. **[15.4-Multus Helm管理规划.md](./15.4-Multus Helm管理规划.md)** - Multus CNI 部署和配置
63. **[15.5-NMState Helm管理规划.md](./15.5-NMState Helm管理规划.md)** - NMState Operator 部署和配置
64. **[15.6-Longhorn Helm管理规划.md](./15.6-Longhorn Helm管理规划.md)** - Longhorn 存储部署和配置
65. **[15.7-cert-manager Helm管理规划.md](./15.7-cert-manager Helm管理规划.md)** - cert-manager 部署和配置
66. **[15.8-依赖关系与部署顺序.md](./15.8-依赖关系与部署顺序.md)** - 技术栈依赖关系和部署顺序
67. **[15.9-统一部署方案.md](./15.9-统一部署方案.md)** - 使用 Helm 统一管理所有依赖

### ISO 安装交付
68. **[16-ISO安装交付/00-ISO安装交付总览.md](./16-ISO安装交付/00-ISO安装交付总览.md)** - ISO 安装交付总览
69. **[16-ISO安装交付/01-ISO制作方案.md](./16-ISO安装交付/01-ISO制作方案.md)** - ISO 制作工具和流程
70. **[16-ISO安装交付/02-系统镜像定制.md](./16-ISO安装交付/02-系统镜像定制.md)** - Ubuntu 系统镜像定制
71. **[16-ISO安装交付/03-预安装脚本概述.md](./16-ISO安装交付/03-预安装脚本概述.md)** - 预安装脚本概述
72. **[16-ISO安装交付/03.1-系统环境准备脚本.md](./16-ISO安装交付/03.1-系统环境准备脚本.md)** - 系统环境准备脚本
73. **[16-ISO安装交付/03.2-k3s安装脚本.md](./16-ISO安装交付/03.2-k3s安装脚本.md)** - k3s 安装脚本
74. **[16-ISO安装交付/03.3-存储安装脚本.md](./16-ISO安装交付/03.3-存储安装脚本.md)** - Longhorn 安装脚本
75. **[16-ISO安装交付/03.4-网络组件安装脚本.md](./16-ISO安装交付/03.4-网络组件安装脚本.md)** - Multus 和 NMState 安装脚本
76. **[16-ISO安装交付/03.5-虚拟化平台安装脚本.md](./16-ISO安装交付/03.5-虚拟化平台安装脚本.md)** - KubeVirt 和 CDI 安装脚本
77. **[16-ISO安装交付/03.6-应用安装脚本.md](./16-ISO安装交付/03.6-应用安装脚本.md)** - Novasphere Operator 安装脚本
78. **[16-ISO安装交付/03.7-主安装脚本.md](./16-ISO安装交付/03.7-主安装脚本.md)** - 主安装流程编排
79. **[16-ISO安装交付/04-应用安装脚本设计.md](./16-ISO安装交付/04-应用安装脚本设计.md)** - 应用安装脚本设计
80. **[16-ISO安装交付/05-配置文件管理.md](./16-ISO安装交付/05-配置文件管理.md)** - 配置文件管理
81. **[16-ISO安装交付/06-依赖包管理.md](./16-ISO安装交付/06-依赖包管理.md)** - 依赖包管理
82. **[16-ISO安装交付/07-安装流程设计.md](./16-ISO安装交付/07-安装流程设计.md)** - 安装流程设计
83. **[16-ISO安装交付/08-验证与测试.md](./16-ISO安装交付/08-验证与测试.md)** - 验证与测试
84. **[16-ISO安装交付/09-ISO发布流程.md](./16-ISO安装交付/09-ISO发布流程.md)** - ISO 发布流程

### 前端架构
85. **[17-前端WEB访问架构方案.md](./17-前端WEB访问架构方案.md)** - 前端 WEB 访问控制 VM 的架构方案
86. **[18-多客户端API Service架构方案.md](./18-多客户端API Service架构方案.md)** - 多客户端（Web/Electron/Flutter）API Service 架构方案
87. **[19-API Gateway网关方案实现.md](./19-API Gateway网关方案实现.md)** - Kong 和 Traefik 网关方案实现
88. **[20-API Service项目组织方案.md](./20-API Service项目组织方案.md)** - API Service 项目组织方式（新建项目 vs Monorepo）
89. **[21-API Service框架选择方案.md](./21-API Service框架选择方案.md)** - API Service 框架选择（Gin/Echo/Fiber/gRPC）
90. **[22-流式数据传输方案详解.md](./22-流式数据传输方案详解.md)** - 流式数据传输方案（SSE/WebSocket/gRPC Stream）
91. **[23-网关流式数据代理详解.md](./23-网关流式数据代理详解.md)** - 网关（Kong/Traefik）流式数据代理支持

## 快速导航

### 项目核心
- **CRD**: `Wukong` - 自定义虚拟机资源
- **Controller**: `WukongReconciler` - 核心协调逻辑
- **技术栈**: k3s + KubeVirt + Multus + Longhorn + CDI

### 关键流程
1. **创建流程**: Wukong CRD → 网络配置 → 存储配置 → KubeVirt VM
2. **状态同步**: VM Status → Wukong Status → Conditions
3. **删除流程**: Finalizer → 清理资源 → 移除 Finalizer

### 技术亮点
- ✅ Kubernetes Operator 模式
- ✅ 多网络接口支持（Multus CNI）
- ✅ 分布式存储集成（Longhorn）
- ✅ Cloud-Init 自动化配置
- ✅ 状态管理和条件判断
- ✅ 资源生命周期管理

## 使用建议

1. **面试前准备**: 重点阅读 `01-整体架构概览.md` 和 `06-面试要点总结.md`
2. **技术深入**: 根据面试官的问题，参考对应的详细文档
3. **代码讲解**: 结合 `05-关键实现细节.md` 中的代码片段进行讲解

## 项目地址

- 项目路径: `/Users/jianfenliu/Workspace/vmoperator`
- 主要代码:
  - Controller: `internal/controller/wukong_controller.go`
  - API: `api/v1alpha1/wukong_types.go`
  - KubeVirt: `pkg/kubevirt/vm.go`
  - Network: `pkg/network/multus.go`
  - Storage: `pkg/storage/reconcile.go`

