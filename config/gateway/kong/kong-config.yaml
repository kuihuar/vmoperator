apiVersion: v1
kind: ConfigMap
metadata:
  name: kong-config
  namespace: kong-system
data:
  kong.yml: |
    _format_version: "3.0"
    
    # 服务定义
    services:
    - name: novasphere-api
      url: http://novasphere-api.novasphere-system.svc.cluster.local:8080
      routes:
      - name: novasphere-api-route
        paths:
        - /api/v1
        strip_path: false
        preserve_host: true
    
    # 插件配置
    plugins:
    # CORS
    - name: cors
      service: novasphere-api
      config:
        origins:
        - "*"
        methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - Authorization
        exposed_headers:
        - X-Auth-Token
        credentials: true
        max_age: 3600
    
    # 限流
    - name: rate-limiting
      service: novasphere-api
      config:
        minute: 100
        hour: 1000
        policy: local

