apiVersion: vm.novasphere.dev/v1alpha1
kind: Wukong
metadata:
  name: ubuntu-noble-local
  labels:
    app.kubernetes.io/name: novasphere
    app.kubernetes.io/managed-by: kustomize
spec:
  cpu: 1
  memory: 1Gi
  
  # 系统盘：从本地 registry 的镜像创建
  # 注意：需要先将镜像推送到本地 registry
  # docker tag novasphere/ubuntu-noble:latest host.docker.internal:5000/ubuntu-noble:latest
  # docker push host.docker.internal:5000/ubuntu-noble:latest
  disks:
    - name: system
      size: 5Gi
      storageClassName: local-path   # k3s 默认 StorageClass
      boot: true
      # 使用 HTTP 源下载镜像（k3s 环境）
      # 注意：在 k3s 中，需要使用实际的虚拟机 IP 地址，而不是 host.docker.internal
      # 确保 HTTP 服务器在宿主机上运行，并且可以从 Pod 网络访问
      image: "http://192.168.1.141:8080/images/noble-server-cloudimg-amd64.img"

      
  
  # 网络配置
  # networks:
  #   - name: default
  #     type: bridge
  #     ipConfig:
  #       mode: dhcp
  
  # Cloud-Init 用户配置
  # 注意：cloud-init 的 passwd 字段需要密码哈希格式
  # 生成密码哈希: echo -n "your-password" | openssl passwd -1 -stdin
  # 或: python3 -c "import crypt; print(crypt.crypt('your-password', crypt.mksalt(crypt.METHOD_SHA512)))"
  cloudInitUser:
    name: ubuntu
    # 方法 1: 使用密码哈希（推荐）
    passwordHash: "$1$7.t8q8zZ$59I1IiMXy5w3gIl5Yrn/4/"  # 替换为实际生成的哈希
    # 方法 2: 使用明文密码（不推荐，可能不会工作）
    # password: "ubuntu123"
    sudo: "ALL=(ALL) NOPASSWD:ALL"
    shell: "/bin/bash"
    groups:
      - sudo
      - adm
      - dialout
    lockPasswd: false
  
  # 启动策略：自动启动
  startStrategy:
    autoStart: true

