apiVersion: vm.novasphere.dev/v1alpha1
kind: Wukong
metadata:
  name: ubuntu-rulai-multus
  labels:
    app.kubernetes.io/name: novasphere
    app.kubernetes.io/managed-by: kustomize
spec:
  cpu: 1
  memory: 2Gi
  
  # 使用 Longhorn StorageClass
  disks:
    # 系统盘：20Gi（适合开发/测试环境）
    # 生产环境建议 30-50Gi
    - name: system
      size: 8Gi
      storageClassName: longhorn  # 使用 Longhorn
      boot: true
      # 使用 HTTP 源下载镜像
      image: "http://192.168.1.141:8080/images/noble-server-cloudimg-amd64.img"
    
    # 数据盘：50Gi（测试系统盘和数据盘分离）
    # 生产环境根据实际需求调整（100Gi-2Ti）
    - name: data
      size: 3Gi
      storageClassName: longhorn
      boot: false
  
  # 网络配置
  networks:
    # 默认网络（集群内网络，使用 masquerade）
    - name: default
      type: bridge
      ipConfig:
        mode: dhcp
    
    # 外网访问网络（使用 macvlan 直接连接物理网络）
    # Multus 会自动创建 NetworkAttachmentDefinition
    - name: external
      type: macvlan
      # bridgeName 字段用于指定 master 网卡（macvlan 需要）
      bridgeName: "ens160"  # 宿主机网卡名称，根据实际情况修改
      ipConfig:
        mode: static
        address: "192.168.1.200/24"  # VM 的静态 IP（请确保未被占用）
        gateway: "192.168.1.1"        # 网关地址
        dnsServers:
          - "192.168.1.1"             # DNS 服务器（通常是网关）
          - "114.114.114.114"         # 备用 DNS
  
  # Cloud-Init 用户配置
  cloudInitUser:
    name: ubuntu
    passwordHash: "$1$7.t8q8zZ$59I1IiMXy5w3gIl5Yrn/4/"  # 替换为实际生成的哈希 ubuntu123
    sudo: "ALL=(ALL) NOPASSWD:ALL"
    shell: "/bin/bash"
    groups:
      - sudo
      - adm
      - dialout
    lockPasswd: false
  
  # 启动策略：自动启动
  startStrategy:
    autoStart: true

