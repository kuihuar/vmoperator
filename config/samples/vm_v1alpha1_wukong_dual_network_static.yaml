apiVersion: vm.novasphere.dev/v1alpha1
kind: Wukong
metadata:
  name: ubuntu-vm-dual-network-static
  labels:
    app.kubernetes.io/name: novasphere
    app.kubernetes.io/managed-by: kustomize
spec:
  cpu: 2
  memory: 4Gi
  
  # 使用 Longhorn StorageClass
  disks:
    # 系统盘
    - name: system
      size: 5Gi
      storageClassName: longhorn
      boot: true
      # 使用 HTTP 源下载镜像
      image: "http://192.168.1.141:8080/images/noble-server-cloudimg-amd64.img"
    
    # 数据盘
    - name: data
      size: 10Gi
      storageClassName: longhorn
      boot: false
  
  # 网络配置：管理网络 + 外网网络
  networks:
    # 1. 默认网络（Pod 网络，用于集群内访问）
    # 注意：default 网络不需要 type 字段，代码会自动使用 Pod 网络（masquerade）
    - name: default
    
    # 2. 管理网络（Bridge + NMState，固定 IP）
    # 用于 SSH、监控、管理操作
    # NMState 会自动创建 br-management 桥接，并将指定的物理网卡作为桥接端口
    # ⚠️ 重要：以下 IP 地址是示例，必须根据你的实际网络环境修改！
    # 1. 检查节点网络：ip addr show（查看实际网段）
    # 2. 检查网关：ip route show default（查看实际网关）
    # 3. 检查 IP 冲突：ping <IP>（确保 IP 未被占用）
    # 4. 确保 IP 不在 DHCP 范围内
    # 详细说明请参考：docs/installation/VM_IP_ADDRESS_PLANNING.md
    # - name: management
    #   type: bridge
    #   bridgeName: "br-management"  # 可选，不指定则使用 br-management
    #   physicalInterface: "ens160"   # ⚠️ 必须指定物理网卡名称，根据实际情况修改！
    #   ipConfig:
    #     mode: static
    #     address: "192.168.1.10/24"  # ⚠️ 示例 IP：请根据实际网络环境修改！确保在 ens160 的网段内（192.168.1.0/24）
    #     gateway: "192.168.1.1"      # ⚠️ 示例网关：请根据实际网络环境修改！
    #     dnsServers:
    #       - "192.168.1.1"           # 管理网络 DNS（通常是网关）
    #       - "114.114.114.114"       # 备用 DNS
    
    # 3. 外网网络（Bridge + NMState，访问外网）
    # 用于访问互联网
    # NMState 会自动创建 br-external 桥接，并将 ens192 作为桥接端口
    # ⚠️ 重要：以下 IP 地址是示例，必须根据你的实际网络环境修改！
    # 1. 检查节点网络：ip addr show ens192（查看实际网段）
    # 2. 检查网关：ip route show default（查看实际网关）
    # 3. 检查 IP 冲突：ping <IP>（确保 IP 未被占用）
    # 4. 确保 IP 不在 DHCP 范围内
    - name: external
      type: bridge
      bridgeName: "br-external"      # 可选，不指定则使用 br-external
      physicalInterface: "ens192"     # 物理网卡名称，NMState 会将此网卡作为桥接端口
      ipConfig:
        mode: static
        address: "192.168.0.200/24"  # ⚠️ 示例 IP：请根据实际网络环境修改！确保在 192.168.0.0/24 网段
        gateway: "192.168.0.1"       # ⚠️ 示例网关：请根据实际网络环境修改！
        dnsServers:
          - "192.168.0.1"            # 外网 DNS（通常是网关）
          - "114.114.114.114"        # 备用 DNS
          - "8.8.8.8"               # Google DNS
  
  # Cloud-Init 用户配置
  cloudInitUser:
    name: ubuntu
    passwordHash: "$1$7.t8q8zZ$59I1IiMXy5w3gIl5Yrn/4/"  # ubuntu123
    sudo: "ALL=(ALL) NOPASSWD:ALL"
    shell: "/bin/bash"
    groups:
      - sudo
      - adm
      - dialout
    lockPasswd: false
  
  # 启动策略：自动启动
  startStrategy:
    autoStart: true

